on: 
   workflow_dispatch:

jobs:
  new_push_job:
    runs-on: ubuntu-latest
    name: New push to repo
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
      
    - name: Check if JSON file exists
      id: check-file
      run: |
          if [ -f "../../version.json" ]; then
            echo "File exists."
            echo "::set-output name=file-exists::true"
          else
            echo "File does not exist."
            echo "::set-output name=file-exists::false"
          fi

    - name: Send GitHub trigger payload to Slack Workflow Builder
      id: slack
      uses: slackapi/slack-github-action@v1.23.0
      with:
        channel-id: 'C058W67M0SC' # ID of Slack Channel you want to post to
        payload: | 
                 {
                   "text": "Deployment finished (Completed)",
                   "attachments": [
                   {
                     "pretext": "Deployment finished",
                     "color": "28a745",
                     "fields": [
                       {
                         "title": "Status",
                         "short": true,
                         "value": "Completed"
                       }
                     ]
                   }
                     ]
                  }
      env:
        SLACK_BOT_TOKEN: ${{secrets.SLACK_BOT_TOKEN}}
